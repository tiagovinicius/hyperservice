stack: "backend"
type: "application"
language: "go"
tasks:
  run:
    command: "moon :integrate && air"
  build:
    script: |
      TARGET_OS=${TARGET_OS:-linux}
      TARGET_ARCH=${TARGET_ARCH:-amd64}
      VERSION=$(cat version.txt)
      GOOS=$TARGET_OS GOARCH=$TARGET_ARCH go build -ldflags "-X main.version=$VERSION($TARGET_OS/$TARGET_ARCH)" -o "./bin/$TARGET_OS-$TARGET_ARCH" ./cmd/server
  integrate:
    script: |
      mkdir -p offline-dependencies/bin/hy-dp 
      moon hyperservice-dataplane:build 
      cp -f /workspaces/hyperservice/apps/hyperservice-dataplane/bin/main offline-dependencies/bin/hy-dp
